---
title: "Mise en oeuvre"
output: html_notebook
---

```{r}
library(ggplot2)
library(ggpubr)
```

```{r, load}
load("data/summaries.Rdata")
load("data/paths.Rdata")
mods_summary <- rbind(lasso_summary, stab_sel_summary)
mods_summary$nzero <- as.integer(mods_summary$nzero)
```

```{r, nzero_score}
ggplot(data = mods_summary) +
        geom_point(aes(x = nzero, y = score, colour = rownames(mods_summary), shape = rownames(mods_summary))) +
        scale_shape_manual(name = "Modèle", values = 1:nrow(mods_summary)) +
        scale_color_discrete(name = "Modèle") +
        labs(x = "Taille du support", y = "Taux d'agrément") +
        theme_bw()
# interprétation
# Performe nettement mieux que Lasso
# Peu de variation dans les résultats de StabSel, mis à part .95 et 1 => le papier de 2010 préconise un seuil de
# stabilité entre .6 et .9 : consistant
#   => très intéressant car permet de s'affranchir du choix de lambda du Lasso qui lui à un impact fort (voir chemin de
#       régularisation)
```

```{r, range_score}
ggplot(data = mods_summary) +
        geom_point(aes(x = range, y = score, colour = rownames(mods_summary), shape = rownames(mods_summary))) +
        scale_shape_manual(name = "Modèle", values = 1:nrow(mods_summary)) +
        scale_color_discrete(name = "Modèle") +
        labs(x = "Amplitude des coefficients (IQR)", y = "Taux d'agrément") +
        theme_bw()
# interprétation :
# amplitude forte => coefficients extrêmes pour compenser les variables instables (bruits) introduites par Lasso ?
```

```{r, roc}
mods_roc <- lapply(mods_summary$vars.idx, function(vars) get_roc(X.train, y.train, X.test, y.test, vars))
names(mods_roc) <- rownames(mods_summary)
ggroc(mods_roc) +
        labs(x = "Spécificité", y = "Sensibilité") +
        scale_color_discrete(name = "Modèle") +
        theme_bw()
```

```{r, auc}
mods_auc <- data.frame(auc = sapply(mods_roc, function(mod_roc) mod_roc$auc), model = names(mods_roc))
ggplot(data = mods_auc) +
        geom_bar(aes(x = model, y = auc, fill = model), stat = "identity") +
        scale_fill_discrete(name = "Modèle") +
        labs(x = "Modèle", y = "AUC") +
        theme_bw() +
        theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r, fig_paths}
stab_path$color <- sapply(stab_path$max_freq, function(f) min(f, .8)) # meme couleur de .8 a 1
fig_stab <- ggplot(data = stab_path) +
        geom_line(aes(x = lambda, y = freq, group = var, color = color)) +
        scale_color_gradient(low = "yellow", high = "red", limits = c(.6, .8), guide = "none") +
        labs(title = "Chemin de stabilité", x = "Lambda index", y = "Probabilité de sélection")

reg_path <- reg_path[order(reg_path$max_freq), ]
reg_path$color <- sapply(reg_path$max_freq, function(f) min(f, .8))
fig_reg <- ggplot(data = reg_path) +
        geom_line(aes(x = lambda, y = beta, group = var, color = color)) +
        scale_color_gradient(low = "yellow", high = "red", limits = c(0.6, .8), guide = "none") +
        labs(title = "Chemin de régularisation", x = "Lambda index", y = "Coefficient")
ggarrange(fig_stab, fig_reg, ncol = 2)

# de nombreuses variables stables n'apparaisent pas de le chemin de régularisation
```
